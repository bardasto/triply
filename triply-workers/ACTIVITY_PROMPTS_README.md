# Activity-Specific Prompts System

## Обзор

Система activity-specific prompts позволяет генерировать уникальные и релевантные маршруты для каждого типа активности. Каждая активность имеет свой собственный промпт с специализированными инструкциями, что обеспечивает более точную и контекстную генерацию.

## Структура файлов

```
triply-workers/src/modules/ai/prompts/
├── base-prompt.ts          # Базовая структура промпта (общая часть)
├── index.ts                # Главный файл - роутер для всех промптов
├── cycling.ts              # Промпт для велосипедных туров
├── beach.ts                # Промпт для пляжного отдыха
├── skiing.ts               # Промпт для горнолыжных туров
├── mountains.ts            # Промпт для горных туров
├── hiking.ts               # Промпт для пеших походов
├── sailing.ts              # Промпт для морских круизов
├── desert.ts               # Промпт для пустынных туров
├── camping.ts              # Промпт для кемпинга
├── city.ts                 # Промпт для городского туризма
├── wellness.ts             # Промпт для велнес-туров
├── road_trip.ts            # Промпт для автомобильных путешествий
├── cultural.ts             # Промпт для культурных туров
├── food.ts                 # Промпт для гастрономических туров
├── nightlife.ts            # Промпт для ночной жизни
└── shopping.ts             # Промпт для шоппинг-туров
```

## Поддерживаемые активности

1. **cycling** - Велосипедные туры (фокус: велодорожки, живописные маршруты, прокат велосипедов)
2. **beach** - Пляжный отдых (фокус: пляжи, водные виды спорта, прибрежные прогулки)
3. **skiing** - Горнолыжные туры (фокус: склоны, подъемники, апре-ски)
4. **mountains** - Горные туры (фокус: вершины, канатные дороги, смотровые площадки)
5. **hiking** - Пешие походы (фокус: тропы, природные парки, водопады)
6. **sailing** - Морские круизы (фокус: марины, яхты, прибрежные города)
7. **desert** - Пустынные туры (фокус: дюны, оазисы, катание на песке)
8. **camping** - Кемпинг (фокус: кемпинги, природа, костры)
9. **city** - Городской туризм (фокус: музеи, достопримечательности, архитектура)
10. **wellness** - Велнес-туры (фокус: спа, йога, медитация, здоровое питание)
11. **road_trip** - Автопутешествия (фокус: живописные дороги, придорожные достопримечательности)
12. **cultural** - Культурные туры (фокус: искусство, история, музеи, наследие)
13. **food** - Гастрономические туры (фокус: рестораны, рынки, кулинарные мастер-классы)
14. **nightlife** - Ночная жизнь (фокус: бары, клубы, живая музыка)
15. **shopping** - Шоппинг-туры (фокус: торговые улицы, бутики, рынки)

## Использование

### В коде генерации

Система автоматически используется в `openai.service.ts`:

```typescript
import { getActivityPrompt } from '../prompts/index.js';

// Генерация промпта для конкретной активности
const prompt = getActivityPrompt({
  city: 'Barcelona',
  country: 'Spain',
  activity: 'cycling',
  durationDays: 3,
  poiListJson: JSON.stringify(poiList),
  restaurantListJson: JSON.stringify(restaurantList),
  language: 'en'
});
```

### Проверка поддержки активности

```typescript
import { isActivitySupported, getSupportedActivities } from './prompts/index.js';

// Проверить, поддерживается ли активность
if (isActivitySupported('cycling')) {
  // Генерировать маршрут
}

// Получить список всех поддерживаемых активностей
const activities = getSupportedActivities();
```

## Особенности каждой активности

### Cycling (Велосипедные туры)
- Велодорожки и безопасные маршруты
- Прокат велосипедов
- Дистанции в км и набор высоты
- Места для отдыха вдоль маршрута

### Beach (Пляжный отдых)
- Лучшие пляжи для купания
- Водные виды спорта (серфинг, снорклинг, каякинг)
- Пляжные клубы и аренда лежаков
- Закаты на берегу моря

### Mountains (Горные туры)
- Горные вершины и смотровые площадки
- Канатные дороги и фуникулеры
- Альпийские озера и водопады
- Информация о высоте и сложности

### City (Городской туризм)
- Музеи и галереи
- Исторические достопримечательности
- Городские районы и архитектура
- Эффективные маршруты через город

### Food (Гастрономические туры)
- Рестораны разных ценовых категорий
- Продуктовые рынки
- Кулинарные мастер-классы
- Дегустации вин и региональные специалитеты

### Hiking (Пешие походы)
- Треккинговые маршруты разной сложности
- Расстояние и набор высоты
- Время прохождения
- Требования к снаряжению

### Cultural (Культурные туры)
- Музеи мирового класса
- Объекты UNESCO
- Художественные галереи
- Исторический контекст

### Wellness (Велнес)
- Спа и массаж
- Йога и медитация
- Здоровое питание
- Термальные источники

### Nightlife (Ночная жизнь)
- Бары и коктейльные заведения
- Клубы и танцполы
- Живая музыка
- График: поздний завтрак → отдых → ночные развлечения

### Shopping (Шоппинг)
- Торговые улицы
- Бутики местных дизайнеров
- Рынки и антиквариат
- Информация о VAT refund

## Тестирование

Для тестирования системы промптов:

```bash
npx tsx test-prompts.ts
```

Тест проверяет:
- Список поддерживаемых активностей
- Проверку поддержки активностей
- Генерацию промптов для разных активностей
- Наличие специфичных ключевых слов в промптах

## Добавление новой активности

1. Создайте файл в `src/modules/ai/prompts/[activity-name].ts`:

```typescript
import { PromptParams } from './base-prompt.js';

export function getYourActivityPrompt(params: PromptParams): string {
  const { durationDays } = params;

  return `
YOUR-ACTIVITY-SPECIFIC INSTRUCTIONS:
1. Daily Schedule Pattern:
   - Morning: ...
   - Lunch: ...

2. Focus on:
   - Key aspect 1
   - Key aspect 2

CRITICAL: Create EXACTLY ${durationDays} days with [activity] experiences!`;
}
```

2. Добавьте импорт и case в `src/modules/ai/prompts/index.ts`:

```typescript
import { getYourActivityPrompt } from './your-activity.js';

// В функции getActivityPrompt добавьте:
case 'your_activity':
  activityInstructions = getYourActivityPrompt(params);
  break;
```

3. Добавьте активность в тип `ActivityType` и массив в `getSupportedActivities()`

## Принципы написания промптов

1. **Специфичность** - каждый промпт должен отражать уникальные аспекты активности
2. **Структурированность** - четкое расписание дня с временем
3. **Реалистичность** - реальные цены, время, расстояния
4. **Детализация** - конкретные места, не общие описания
5. **Практичность** - транспорт, логистика, советы
6. **Безопасность** - предупреждения и требования к подготовке
7. **Культурный контекст** - местные обычаи и этикет

## Примеры выходных данных

### Для cycling activity:
```json
{
  "title": "Barcelona Coastal Cycling Adventure",
  "itinerary": [
    {
      "day": 1,
      "places": [
        {
          "name": "Bike rental",
          "type": "service",
          "duration_minutes": 30,
          "price": "€20",
          "transportation": {
            "method": "walk",
            "duration_minutes": 0
          }
        },
        {
          "name": "Coastal bike path",
          "type": "cycling_route",
          "duration_minutes": 90,
          "distance_km": 15,
          "elevation_gain": "+50m"
        }
      ]
    }
  ]
}
```

## Мониторинг и улучшение

После внедрения рекомендуется:
1. Отслеживать качество сгенерированных маршрутов
2. Собирать feedback пользователей
3. Анализировать типичные ошибки AI
4. Итеративно улучшать промпты
5. Добавлять больше примеров в промпты

## Известные ограничения

1. Размер промпта ограничен token limit (используйте сжатые описания)
2. AI может отклоняться от инструкций - валидация обязательна
3. Некоторые активности могут требовать больше контекста
4. Сезонность не всегда учитывается автоматически

## Связанные файлы

- `src/modules/ai/services/openai.service.ts` - использует промпты для генерации
- `src/modules/trips/jobs/generate-trips.ts` - вызывает генерацию для разных активностей
- `src/shared/types/index.ts` - типы ActivityType

## Обновления

- **2025-11-19**: Первоначальная версия с 15 активностями
- Будущие обновления будут документироваться здесь
